---
title: æœ€è¿‘å€¼å¾—è®°å½•çš„ä¸€äº›å°å°è¯•
date: 2023-07-26
tags:
  - PWA
  - React Native
  - æ–°æŠ€æœ¯è¶‹åŠ¿
draft: false
authors: []
summary: æœ€è¿‘å¼€å‘äº†ä¸€ä¸ªä¼‘æ¯æé†’çš„PWAåº”ç”¨ï¼Œä½¿ç”¨Reactå’ŒTypeScriptï¼Œé›†æˆäº†é€šçŸ¥ã€çƒ­åŠ›å›¾ç­‰åŠŸèƒ½ï¼Œæ¢ç´¢æ–°æŠ€æœ¯ã€‚
---

æœ€è¿‘å†™äº†ä¸€ä¸ªä¼‘æ¯æé†’çš„ PWA çš„åº”ç”¨ï¼Œç”¨æ¥è®¾å®šå·¥ä½œä¸€æ®µæ—¶é—´åï¼Œæé†’æˆ‘è¦ä¼‘æ¯äº†ã€‚æœ‰ç‚¹ç±»ä¼¼äºç•ªèŒ„æ—¶é’Ÿã€‚
åº”ç”¨åœ°å€æ˜¯[è¿™ä¸ªï½](https://pomodoro-clock-pwa.vercel.app/)ã€‚

<div className="relative h-[400px]">
  <Image
    style={{ objectFit: 'contain' }}
    className="my-0"
    alt="fiddler screenshot"
    src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690291909922-bca25574-b801-4ae6-b6ee-d32d86a0efe2.png"
    fill={true}
  />
</div>

å®ƒçš„åŠŸèƒ½åŒ…æ‹¬ï¼š

- å·¥ä½œå€’è®¡æ—¶ç»“æŸåï¼Œä¼šé€šè¿‡æµè§ˆå™¨ Notification é€šçŸ¥åˆ°æˆ‘
  <div className="relative h-[400px]">
    <Image
      style={{ objectFit: 'contain' }}
      className="my-0"
      alt="fiddler screenshot"
      src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690292100204-05f321ef-9f3d-4fa4-acf9-a931b26dacad.png"
      fill={true}
    />
  </div>
- å¯ä»¥è®¾å®šæ¯æ¬¡çš„å·¥ä½œæ—¶é•¿ï¼Œä¼‘æ¯æ—¶é•¿ï¼Œæç¤ºè¯­ã€‚
  <div className="relative h-[400px]">
    <Image
      style={{ objectFit: 'contain' }}
      className="my-0"
      alt="fiddler screenshot"
      src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690292163537-49c9ca8f-ae72-46cc-ad86-a89c23335006.png"
      fill={true}
    />
  </div>{' '}
- æŸ¥çœ‹å½“å‰å¹´çš„å·¥ä½œ/ä¼‘æ¯çƒ­åŠ›å›¾
  <div className="relative h-[400px]">
    <Image
      style={{ objectFit: 'contain' }}
      className="my-0"
      alt="fiddler screenshot"
      src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690292247266-95cd59df-4039-4b1e-bd84-0c8c5a406a0a.png"
      fill={true}
    />
  </div>{' '}

æœ€å¼€å§‹æˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›ä¼‘æ¯æé†’çš„åº”ç”¨ï¼Œä½†æ˜¯éƒ½ä¸å¤ªæ»¡æ„ï¼Œäºæ˜¯æƒ³ç€å°±è‡ªå·±å†™ä¸€ä¸ªã€‚æ­£å¥½å¯ä»¥åº”ç”¨ä¸€äº›æ–°æŠ€æœ¯ï¼Œæ¯”å¦‚è¯´ reactï¼Œpwaï¼Œ google analyticsï¼Œç¦»çº¿åº”ç”¨ç­‰ã€‚

## React

å·¥ä½œä»¥æ¥ä½¿ç”¨çš„å‰ç«¯æ¡†æ¶ä¸€ç›´éƒ½æ˜¯ Vueï¼ŒReact æ¯”è¾ƒå°‘ç”¨åˆ°ã€‚è¿™æ¬¡ä½¿ç”¨ Create React App + TypeScript + react hooks ä½œä¸ºä¸»è¦çš„æŠ€æœ¯æ ˆã€‚æˆ‘çš„æ„Ÿå—æ˜¯ï¼Œreact hooks æ¯” Vue éš¾å¤šäº†ã€‚å¦‚æœä½ æ²¡æœ‰é¢†æ‚Ÿ `å¯¹äº react functional component æ¥è¯´ï¼Œè¿è¡Œè¿™ä¸ªå‡½æ•°åªæ˜¯å¾—åˆ°å½“å‰å¸§` è¿™ä¸€å±‚çš„è¯ï¼Œæ˜¯å¾ˆéš¾ç†è§£ hooks çš„ã€‚

## Eslint

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å°è¯•ä¸å†ä½¿ç”¨`prettier`æ¥æ ¼å¼åŒ–æˆ‘çš„ä»£ç ã€‚è€Œæ˜¯å°†`code style`è¿™ä¸€éƒ¨åˆ†çš„å·¥ä½œä¹Ÿäº¤ç»™ eslint æ¥åšã€‚ç¼˜ç”±å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç«  ã€Œ[ä¸ºä»€ä¹ˆæˆ‘ä¸ä½¿ç”¨ Prettier](https://antfu.me/posts/why-not-prettier-zh)ã€ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹

1. prettier é¢„è®¾çš„ code style å¾ˆå¥½ï¼Œä½†æ˜¯æƒ³è¦åœ¨è¿™ä¸Šé¢ä¸ªæ€§åŒ–å´å¾ˆéš¾ã€‚
2. æœ‰æ—¶å€™åªæ˜¯ä¿®æ”¹äº†ä¸€ç‚¹ç‚¹ä¸œè¥¿ï¼Œå´è§¦å‘äº†æœ€å¤§é•¿åº¦å¼ºåˆ¶æ¢è¡Œã€‚è¿™åœ¨ git diff è§†å›¾ä¸­å¾ˆå›°æ‰°ã€‚
   {' '}
   <div className="relative h-[400px]">
     <Image
       style={{ objectFit: 'contain' }}
       className="my-0"
       alt="fiddler screenshot"
       src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690293377150-2e9767a3-cc1d-4d43-9d01-0a5017d2e663.png"
       fill={true}
     />
   </div>{' '}
3. å’Œ eslint æœ‰äº›åŠŸèƒ½é…ç½®å­˜åœ¨å†²çªã€‚
4. eslint å’Œ prettier éœ€è¦ä¸¤ä¸ªä¸åŒçš„ parserï¼Œå¯¹æœºå™¨ä¹Ÿæ˜¯ä¸€ç§è´Ÿæ‹…ã€‚

å› æ­¤ï¼Œä½œè€…è®¤ä¸ºä½¿ç”¨ prettier ä¸æ˜¯ç‰¹åˆ«å¿…éœ€ï¼Œeslint ä¹Ÿå¯ä»¥æ‰¿æ‹…è¿™éƒ¨åˆ†çš„å·¥ä½œï¼Œå¹¶ä¸”æ›´è‡ªç”±ã€‚
ä»–ä¹Ÿå¼€æºäº†ä»–è‡ªå·±çš„[é¢„è®¾é›†](https://github.com/antfu/eslint-config)ã€‚

æˆ‘ä¹Ÿå°è¯•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ª eslint è§„åˆ™é›†åˆã€‚

```json
{
  "eslintConfig": {
    "extends": [
      "@antfu/eslint-config-ts",
      "plugin:react-hooks/recommended",
      "plugin:react/recommended"
    ],
    "rules": {
      "jsx-quotes": ["error", "prefer-double"],
      "react/react-in-jsx-scope": "off",
      "no-debugger": "off",
      "no-restricted-syntax": "off",
      "no-console": "off",
      "no-new": "off"
    }
  }
}
```

æ•´ä½“ä½¿ç”¨ä¸‹æ¥ï¼Œè¿˜æ˜¯æœ‰å‡ å¤„åœ°æ–¹çš„ code style åšçš„ä¸å¥½ï¼ˆä¹Ÿè®¸é…ç½®å¥½å¯¹åº”çš„ eslint è§„åˆ™å°±å¯ä»¥æ»¡è¶³ï¼‰

1. é“¾å¼è°ƒç”¨æ²¡æœ‰è¦æ±‚æ¢è¡Œï¼Œçœ‹èµ·æ¥ä¸ç›´è§‚ã€‚
   <div className="relative h-[400px]">
     <Image
       style={{ objectFit: 'contain' }}
       className="my-0"
       alt="fiddler screenshot"
       src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690294013662-c2063267-ac09-4248-a92b-f09014103380.png"
       fill={true}
     />
   </div>{' '}
2. å¯¹äº jsx ï¼Œæ²¡æœ‰è®¾ç½®å¥½çš„ code style è§„åˆ™ã€‚className å¯ä»¥å†™å¾ˆé•¿å¾ˆé•¿ï¼Œä¸å¥½çœ‹ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒæ•´ã€‚å¦‚æœæ˜¯ prettier çš„è¯ï¼Œä¼šè‡ªåŠ¨æ ¼å¼åŒ–å¥½æ ‡ç­¾çš„å±æ€§ï¼Œçœ‹èµ·æ¥å°±æ¯”è¾ƒèˆ’æœã€‚

<div className="relative h-[400px]">
  <Image
    style={{ objectFit: 'contain' }}
    className="my-0"
    alt="fiddler screenshot"
    src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690294129875-cdde1063-44b3-473a-b092-bfcfaa23b3f2.png"
    fill={true}
  />
</div>{' '}

å…¶ä»–ä½“éªŒéƒ½æŒºå¥½ã€‚

## PWA

create-react-app åˆ›å»ºçš„é¡¹ç›®é»˜è®¤éƒ½æ˜¯é…ç½®å¥½ manifest.json çš„ï¼Œå‘å¸ƒåå°±å¯ä»¥ç‚¹å‡»åœ°å€æ çš„`å®‰è£…åˆ°æœ¬åœ°`æŒ‰é’®å®‰è£…åˆ°æœ¬åœ°äº†ã€‚è¿™æ—¶å€™è¿˜æ²¡æœ‰ç¦»çº¿èƒ½åŠ›ï¼Œè¿˜éœ€è¦é…åˆ Service Workder æ¥ç¼“å­˜èµ„æºã€‚ä¸å¤šè¯´ï¼Œç›´æ¥ä½¿ç”¨ google è‡ªå®¶å®Œå–„çš„è§£å†³æ–¹æ¡ˆ `webbox`ã€‚

1. åˆå§‹åŒ– webbox é…ç½®æ–‡ä»¶

```bash
npx workbox wizard
```

2. é…ç½® webbox

```javascript
module.exports = {
  globDirectory: 'build/',
  globPatterns: ['**/*.{json,png,ico,html,txt,css,js}'],
  swDest: 'build/sw.js',
  ignoreURLParametersMatching: [/^utm_/, /^fbclid$/],
  runtimeCaching: [
    {
      urlPattern: /\.html$/,
      // é¦–é¡µæ–‡ä»¶ä¸èƒ½é…ç½® expiration seconds,
      // ä¼šå¯¼è‡´å¦‚æœæ—¶é—´æ²¡æœ‰è¿‡æœŸå°±ä¼šä¸€ç›´ä½¿ç”¨ç¼“å­˜ä¸­çš„æ–‡ä»¶
      handler: 'CacheFirst',
      options: {
        cacheName: 'entry',
      },
    },
    {
      urlPattern: /\.(?:css|js|png|gif)$/,
      handler: 'StaleWhileRevalidate',
      options: {
        cacheName: 'all',
        expiration: {
          maxEntries: 20,
          maxAgeSeconds: 7 * 24 * 60 * 60, // 7 å¤©
        },
      },
    },
  ],
}
```

webbox çš„ç¼“å­˜ç­–ç•¥æœ‰ï¼š

- CacheOnly
- CacheFirst
- NetworkOnly
- NetworkFirst
- StaleWhileRevalidate

å‰é¢å››ä¸ªéƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œæœ€åä¸€ä¸ªæ˜¯æœ€å¤æ‚çš„ï¼Œå·¥ä½œæµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š

> 1. On the first request for an asset, fetch it from the network, place it in the cache, and return the network response.
> 2. On subsequent requests, serve the asset from the cache first, then "in the background," re-request it from the network and update the asset's cache entry.
> 3. For requests after that, you'll receive the last version fetched from the network that was placed in the cache in the prior step.

3. ç”Ÿæˆ sw.js

```bash
pnpm add webbox-cli -D
workbox generateSW workbox-config.js
```

4. æ³¨å†Œ sw.js

```javascript
import { Workbox } from 'workbox-window'

if (process.env.NODE_ENV === 'production') {
  if ('serviceWorker' in navigator) {
    const wb = new Workbox('/sw.js')

    wb.addEventListener('waiting', () => {
      // å½“æœ‰æ–°çš„ç‰ˆæœ¬å®‰è£…çš„æ—¶å€™ï¼Œç«‹é©¬è·³è¿‡ç­‰å¾…ï¼Œè®©å…¶ç”Ÿæ•ˆã€‚
      // å¦åˆ™ç›´åˆ°æ‰€æœ‰ä½¿ç”¨è¯¥ sw çš„tab éƒ½å…³é—­åæ‰ç”Ÿæ•ˆã€‚
      wb.messageSkipWaiting()
    })

    wb.addEventListener('controlling', () => {
      // å½“æ–°ç‰ˆæœ¬çš„ service workder ç”Ÿæ•ˆçš„æ—¶å€™ï¼Œreload é¡µé¢ï¼Œåº”ç”¨æ–°çš„ç¼“å­˜ã€‚
      window.location.reload()
    })

    wb.register()
  }
}
```

## Sentry

æ„Ÿè§‰å¤–å›½äººåšçš„ä¸œè¥¿éƒ½æ¯”è¾ƒå¥½Â ğŸ¤£ã€‚

è¯•ç”¨äº† Sentry Cloudï¼Œæ¥å…¥æ­¥éª¤å¦‚ä¸‹ï¼š

1. é¦–å…ˆåœ¨ sentry.io åˆ›å»ºé¡¹ç›®
2. å®‰è£… cli

```bash
pnpm add @sentry/cli -D
```

3. æ„å»ºä¹‹åä¸Šä¼  sourcemap

```bash
sentry-cli sourcemaps inject --org maurice-rk --project pomodoro-clock-pwa ./build && sentry-cli sourcemaps upload --org maurice-rk --project pomodoro-clock-pwa ./build
```

ç›´æ¥å°±å¯ä»¥è¿›è¡Œåº”ç”¨é”™è¯¯ç›‘æ§å•¦

<div className="relative h-[400px]">
  <Image
    style={{ objectFit: 'contain' }}
    className="my-0"
    alt="fiddler screenshot"
    src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690296896993-9e40c639-5da3-4e07-a9dd-9dbd2282ce2e.png"
    fill={true}
  />
</div>{' '}

sentry ä¸ä»…æ”¯æŒå‰ç«¯åº”ç”¨ï¼Œä¹Ÿæ”¯æŒ node.js åº”ç”¨ï¼Œå…¶ä»–è¯­è¨€ä¹Ÿæ”¯æŒã€‚

## Daisy ui

åŸºäº tailwindcssçš„ï¼Œçº¯ html/css çš„ç»„ä»¶åº“ã€‚

## Tailwindcss

åŸå­åŒ– css æ¡†æ¶ã€‚

1. åˆå§‹åŒ–é…ç½®æ–‡ä»¶ã€‚

```bash
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init
```

2. åœ¨ css ä¸­æ·»åŠ  Tailwind æŒ‡ä»¤

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

åœ¨ css ä¸­ï¼Œ`@tailwind`æ˜¯åˆæ³•çš„ï¼Œå±äº [at-rule](https://developer.mozilla.org/en-US/docs/Web/CSS/At-rule)ã€‚å®ƒéœ€è¦è¿›ä¸€æ­¥è¢« PostCss å¤„ç†ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ Create-React-App åˆ›å»ºçš„ï¼Œé»˜è®¤çš„ react-scripts å°±å·²ç»é…ç½®å¥½äº† postcss çš„ tailwindcss pluginã€‚

å‰ææ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹é¢ï¼Œæœ‰ tailwind.config.js è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚

<div className="relative h-[400px]">
  <Image
    style={{ objectFit: 'contain' }}
    className="my-0"
    alt="fiddler screenshot"
    src="https://cdn.nlark.com/yuque/0/2023/png/438262/1690339448415-c7ba275d-f3aa-4a0a-8695-568add6528bc.png"
    fill={true}
  />
</div>{' '}
